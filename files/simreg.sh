#!/bin/bash

#Install curl on ubuntu-jumpbox:
kubectl exec -it ubuntu-jump-box -- bash -c "apt-get update && apt-get install -y curl"

#Register sim-ausf and sim-udm with nrf (routing indicator set to 1111):
kubectl exec -it ubuntu-jump-box  -c ubuntu-jump-box -- curl --verbose -X PUT -H "Content-Type: application/json" http://nrf1-nnrf:80/nnrf-nfm/v1/nf-instances/sim-ausf --http2-prior-knowledge -d '{"nfInstanceId":"sim-ausf","manualMode":"true","nfType":"AUSF","nfStatus":"REGISTERED","heartBeatTimer":3600,"plmnList":[{"mcc":"450","mnc":"05"}],"sNssais":[{"sst":1,"sd":"ab2112"},{"sst":2,"sd":"ab2112"},{"sst":3,"sd":"ab2112"}],"fqdn":"sim-ausf:80","ausfInfo":{"supiRanges":[{"start":"450051111000000","end":"450051111000010"}],"routingIndicators":["1111"]},"nfServices":[{"serviceInstanceId":"sim-ausf","serviceName":"nausf-auth","versions":[{"apiVersionInUri":"v1","apiFullVersion":"1.0.0"}],"scheme":"http","nfServiceStatus":"REGISTERED"},{"serviceInstanceId":"sim-ausf","serviceName":"nausf-sorprotection","versions":[{"apiVersionInUri":"v1","apiFullVersion":"1.0.0"}],"scheme":"http","nfServiceStatus":"REGISTERED"}]}'
 
kubectl exec -it ubuntu-jump-box  -c ubuntu-jump-box -- curl --verbose -X PUT -H "Content-Type: application/json" http://nrf1-nnrf:80/nnrf-nfm/v1/nf-instances/sim-udm --http2-prior-knowledge -d '{"nfInstanceId":"sim-udm","nfType":"UDM","nfStatus":"REGISTERED","heartBeatTimer":120,"plmnList":[{"mcc":"450","mnc":"05"}],"sNssais":[{"sst":1,"sd":"ab2112"},{"sst":2,"sd":"ab2112"},{"sst":3,"sd":"ab2112"}],"fqdn":"sim-udm:80","manualMode":"true","udmInfo":{"supiRanges":[{"start":"450051111000000","end":"450051111000010"}],"routingIndicators":["1111"]},"nfServices":[{"serviceInstanceId":"sim-udm","serviceName":"nudm-sdm","versions":[{"apiVersionInUri":"v2","apiFullVersion":"2.0.0.alpha-1"}],"scheme":"http","nfServiceStatus":"REGISTERED","fqdn":"sim-udm:80"},{"serviceInstanceId":"sim-udm","serviceName":"nudm-uecm","versions":[{"apiVersionInUri":"v1","apiFullVersion":"1.0.0"}],"scheme":"http","nfServiceStatus":"REGISTERED","fqdn":"sim-udm:80"}]}'
 
#You can check the nrf registrations by running the nrf_query.sh script under
# ubuntu@5gc-build-server:~/casa-5gc/install_v5.2.0/tools directory
 
#You can remove the nrf registrations with:
#kubectl exec -it ubuntu-jump-box  -c ubuntu-jump-box -- curl --verbose -X DELETE -H "Content-Type: application/json" http://nrf1-nnrf:80/nnrf-nfm/v1/nf-instances/sim-udm
#kubectl exec -it ubuntu-jump-box  -c ubuntu-jump-box -- curl --verbose -X DELETE -H "Content-Type: application/json" http://nrf1-nnrf:80/nnrf-nfm/v1/nf-instances/sim-ausf
#Create a sample subscriber (imsi-450051111000005) in sim-udm:
#kubectl exec -it ubuntu-jump-box  -c ubuntu-jump-box -- curl --verbose -X PUT -H "Content-Type: application/json"  http://sim-udm:80/udm-configure/sdm/v1/imsi-450051111000005 -d '{"gpsi": "1234567890","supi": "imsi-450051111000005", "subscriptionDataSets": {"amData": {"supportedFeatures":"support","gpsis":["gpsi1234","gpsi5678"],"internalGroupIds":["internalGroupId0","internalGroupId1"],"subscribedUeAmbr":{"uplink":"120 Mbps","downlink":"110 Mbps"},"nssai":{"supportedFeatures":"support1","defaultSingleNssais":[{"sst":1,"sd":"ab2112"}],"singleNssais":[{"sst":2,"sd":"ab2112"},{"sst":3,"sd":"ab2112"}]},"ratRestrictions":["WLAN","VIRTUAL"],"forbiddenAreas":[{"tacs":["tac1"],"areaCodes":"areaCodes1"},{"tacs":["tac3","tac4"],"areaCodes":"areaCodes3"}],"serviceAreaRestriction":{"restrictionType":"ALLOWED_AREAS","areas":[{"tacs":["svcAreaTac1","svcAreaTac2"],"areaCodes":"svcAreaCodes1"},{"tacs":["svcAreaTac3","svcAreaTac4"],"areaCodes":"svcAreaCodes3"}],"maxNumOfTAs":123},"coreNetworkTypeRestrictions":["5GC", "EPC"],"rfspIndex":12,"subsRegTimer":13,"ueUsageType":14,"mpsPriority":true,"mcsPriority":false,"activeTime":15,"dlPacketCount":16,"sorInfo":{"ackInd":true,"sorMacIausf":"sorMacIausf.val","countersor":"countersor.val"},"micoAllowed":true,"sharedDataIds":["sharedDataId1","sharedDataId2"],"odbPacketServices":"string"},"smfSelData":{"supportedFeatures":"SUPPORT","subscribedSnssaiInfos":{"1":{"dnnInfos":[{"dnn":"inet1","defaultDnnIndicator":true,"lboRoamingAllowed":true,"iwkEpsInd":true,"ladnIndicator":true}]},"2":{"dnnInfos":[{"dnn":"inet2","defaultDnnIndicator":false,"lboRoamingAllowed":true,"iwkEpsInd":true,"ladnIndicator":true}]}},"sharedSnssaiInfosId":"string"},"uecSmfData":{"pduSessions":{"1":{"dnn":"inet1","smfInstanceId":"smfId1","plmnId":{"mcc":"450","mnc":"05"}},"2":{"dnn":"inet2","smfInstanceId":"smfId2","plmnId":{"mcc":"450","mnc":"05"}}},"pgwInfo":[{"dnn":"inet1","pgwFqdn":"upf1","plmnId":{"mcc":"450","mnc":"05"}},{"dnn":"inet2","pgwFqdn":"upf2","plmnId":{"mcc":"450","mnc":"05"}}]},"uecSmsfData":{"smsfInfo3GppAccess":{"smsfInstanceId":"smsfInstanceId.val","plmnId":{"mcc":"450","mnc":"05"}},"smsfInfoNon3GppAccess":{"smsfInstanceId":"smsfInstanceId.val","plmnId":{"mcc":"450","mnc":"05"}}},"smsSubsData":{"smsSubscribed":true,"sharedDataIds":["sharedDataId1","sharedDataId2"]},"smData":[{"singleNssai":{"sst":1,"sd":"ab2112"},"dnnConfigurations":{"inet1":{"pduSessionTypes":{"defaultSessionType":"IPV4","allowedSessionTypes":["IPV6","IPV4V6"]},"sscModes":{"defaultSscMode":"SSC_MODE_1","allowedSscModes":["SSC_MODE_1","SSC_MODE_2","SSC_MODE_3"]},"iwkEpsInd":true,"ladnIndicator":true,"5gQosProfile":{"5qi":5,"priorityLevel":2,"arp":{"priorityLevel":1,"preemptCap":"MAY_PREEMPT","preemptVuln":"NOT_PREEMPTABLE"}},"sessionAmbr":{"uplink":"101 Mbps","downlink":"102 Mbps"},"3gppChargingCharacteristics":"0001","staticIpAddress":[],"upSecurity":{"upIntegr":"REQUIRED","upConfid":"NOT_NEEDED"}},"inet2":{"pduSessionTypes":{"defaultSessionType":"IPV4","allowedSessionTypes":["IPV6","IPV4V6"]},"sscModes":{"defaultSscMode":"SSC_MODE_1","allowedSscModes":["SSC_MODE_1","SSC_MODE_2","SSC_MODE_3"]},"iwkEpsInd":true,"ladnIndicator":true,"5gQosProfile":{"5qi":5,"priorityLevel":2,"arp":{"priorityLevel":1,"preemptCap":"MAY_PREEMPT","preemptVuln":"NOT_PREEMPTABLE"}},"sessionAmbr":{"uplink":"101 Mbps","downlink":"102 Mbps"},"3gppChargingCharacteristics":"0002","staticIpAddress":[],"upSecurity":{"upIntegr":"REQUIRED","upConfid":"NOT_NEEDED"}}},"internalGroupIds":["internalGroupId-1"],"sharedDnnConfigurationsId":"string"},{"singleNssai":{"sst":2,"sd":"ab2112"},"dnnConfigurations":{"inet1":{"pduSessionTypes":{"defaultSessionType":"IPV4","allowedSessionTypes":["IPV6","IPV4V6"]},"sscModes":{"defaultSscMode":"SSC_MODE_1","allowedSscModes":["SSC_MODE_1","SSC_MODE_2","SSC_MODE_3"]},"iwkEpsInd":true,"ladnIndicator":true,"5gQosProfile":{"5qi":5,"priorityLevel":2,"arp":{"priorityLevel":1,"preemptCap":"MAY_PREEMPT","preemptVuln":"NOT_PREEMPTABLE"}},"sessionAmbr":{"uplink":"101 Mbps","downlink":"102 Mbps"},"3gppChargingCharacteristics":"0001","staticIpAddress":[],"upSecurity":{"upIntegr":"REQUIRED","upConfid":"NOT_NEEDED"}},"inet2":{"pduSessionTypes":{"defaultSessionType":"IPV4","allowedSessionTypes":["IPV6","IPV4V6"]},"sscModes":{"defaultSscMode":"SSC_MODE_1","allowedSscModes":["SSC_MODE_1","SSC_MODE_2","SSC_MODE_3"]},"iwkEpsInd":true,"ladnIndicator":true,"5gQosProfile":{"5qi":5,"priorityLevel":2,"arp":{"priorityLevel":1,"preemptCap":"MAY_PREEMPT","preemptVuln":"NOT_PREEMPTABLE"}},"sessionAmbr":{"uplink":"101 Mbps","downlink":"102 Mbps"},"3gppChargingCharacteristics":"0002","staticIpAddress":[],"upSecurity":{"upIntegr":"REQUIRED","upConfid":"NOT_NEEDED"}}},"internalGroupIds":["internalGroupId-1"],"sharedDnnConfigurationsId":"string"}],"traceData":{"traceRef":"traceRefVal","traceDepth":"MEDIUM","neTypeList":"EEAA","eventList":"22","collectionEntityIpv4Addr":"1.2.3.4","collectionEntityIpv6Addr":"1.2.3.4::","interfaceList":"ABCD"},"smsMngData":{"supportedFeatures":"supported","mtSmsSubscribed":true,"mtSmsBarringAll":true,"mtSmsBarringRoaming":true,"moSmsSubscribed":true,"moSmsBarringAll":true,"moSmsBarringRoaming":true,"sharedSmsMngDataIds":["sharedDataId1","sharedDataId2"]}}}'
